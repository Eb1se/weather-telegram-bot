"""
–ú–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Open-Meteo Weather API.
–ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ –∏ –ø—Ä–æ–≥–Ω–æ–∑—ã –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤.
"""

import aiohttp

async def get_weather(city: str, days: int) -> str:
    """
    –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã.
    –í—ã–ø–æ–ª–Ω—è–µ—Ç –¥–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ API: –≥–µ–æ–∫–æ–¥–∏–Ω–≥ –∏ –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã.
    
    –ü—Ä–æ—Ü–µ—Å—Å:
    1. –ì–µ–æ–∫–æ–¥–∏–Ω–≥: –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (—à–∏—Ä–æ—Ç–∞, –¥–æ–ª–≥–æ—Ç–∞)
    2. –ü—Ä–æ–≥–Ω–æ–∑: –ü–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ
    
    Args:
        city (str): –ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä: "Moscow", "London")
        days (int): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –ø—Ä–æ–≥–Ω–æ–∑–∞ (1 - —Å–µ–≥–æ–¥–Ω—è, 3, 7, 14 - –ø—Ä–æ–≥–Ω–æ–∑)
    
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–≥–æ–¥–µ
    
    Raises:
        Exception: –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å–µ—Ç–∏ –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    """
    try:
        # –°–æ–∑–¥–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é HTTP-—Å–µ—Å—Å–∏—é –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
        async with aiohttp.ClientSession() as session:
            """
            –®–ê–ì 1: –ì–ï–û–ö–û–î–ò–ù–ì - –ü–†–ï–û–ë–†–ê–ó–£–ï–ú –ì–û–†–û–î –í –ö–û–û–†–î–ò–ù–ê–¢–´
            Open-Meteo Geocoding API: https://open-meteo.com/en/docs/geocoding-api
            """
            async with session.get(
                "https://geocoding-api.open-meteo.com/v1/search",
                params={"name": city, "count": 1}  # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
            ) as response:
                # –ü–æ–ª—É—á–∞–µ–º JSON –æ—Ç–≤–µ—Ç –æ—Ç API –≥–µ–æ–∫–æ–¥–∏–Ω–≥–∞
                locations = await response.json()
            
            """
            –ê–ù–ê–õ–ò–ó –û–¢–í–ï–¢–ê –ì–ï–û–ö–û–î–ò–ù–ì–ê:
            –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
            {
                "results": [
                    {
                        "name": "Moscow",
                        "latitude": 55.7558,
                        "longitude": 37.6176,
                        ...
                    }
                ]
            }
            """
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—à–µ–ª –ª–∏ API –≥–æ—Ä–æ–¥
            if not locations.get("results"):
                return "–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω"
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–≤–æ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞
            location = locations["results"][0]
            lat = location["latitude"]   # –®–∏—Ä–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 55.7558)
            lon = location["longitude"]  # –î–æ–ª–≥–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 37.6176)
            city_name = location["name"] # –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
            
            """
            –®–ê–ì 2: –ü–û–õ–£–ß–ê–ï–ú –ü–†–û–ì–ù–û–ó –ü–û–ì–û–î–´ –ü–û –ö–û–û–†–î–ò–ù–ê–¢–ê–ú
            Open-Meteo Weather API: https://open-meteo.com/en/docs
            """
            async with session.get(
                "https://api.open-meteo.com/v1/forecast",
                params={
                    "latitude": lat,      # –®–∏—Ä–æ—Ç–∞ –∏–∑ –≥–µ–æ–∫–æ–¥–∏–Ω–≥–∞
                    "longitude": lon,    # –î–æ–ª–≥–æ—Ç–∞ –∏–∑ –≥–µ–æ–∫–æ–¥–∏–Ω–≥–∞
                    # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ –ø–æ–≥–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
                    "daily": "temperature_2m_max,temperature_2m_min,precipitation_probability_max,weathercode",
                    "forecast_days": days  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –ø—Ä–æ–≥–Ω–æ–∑–∞
                }
            ) as response:
                # –ü–æ–ª—É—á–∞–µ–º JSON –æ—Ç–≤–µ—Ç —Å –ø—Ä–æ–≥–Ω–æ–∑–æ–º –ø–æ–≥–æ–¥—ã
                forecast = await response.json()
            
            """
            –ê–ù–ê–õ–ò–ó –û–¢–í–ï–¢–ê –ü–û–ì–û–î–ù–û–ì–û API:
            –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç daily –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
            {
                "daily": {
                    "time": ["2023-11-05", "2023-11-06", ...],
                    "temperature_2m_max": [10.5, 12.3, ...],
                    "temperature_2m_min": [5.2, 6.8, ...],
                    "precipitation_probability_max": [30, 45, ...],
                    "weathercode": [0, 1, ...]
                }
            }
            """
            
            # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–Ω–µ–π
            if days == 1:
                """
                –°–¶–ï–ù–ê–†–ò–ô: –ü–û–ì–û–î–ê –ù–ê –°–ï–ì–û–î–ù–Ø
                –ë–µ—Ä–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è (—Å–µ–≥–æ–¥–Ω—è)
                """
                # –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –º–∞–∫—Å–∏–º—É–º —Å–µ–≥–æ–¥–Ω—è
                temp_max = forecast["daily"]["temperature_2m_max"][0]
                # –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –º–∏–Ω–∏–º—É–º —Å–µ–≥–æ–¥–Ω—è  
                temp_min = forecast["daily"]["temperature_2m_min"][0]
                # –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Å–∞–¥–∫–æ–≤ —Å–µ–≥–æ–¥–Ω—è
                precip = forecast["daily"]["precipitation_probability_max"][0]
                
                # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –¥–ª—è –æ–¥–Ω–æ–≥–æ –¥–Ω—è
                return f"üå§Ô∏è –ü–æ–≥–æ–¥–∞ –≤ {city_name} —Å–µ–≥–æ–¥–Ω—è:\n" \
                       f"üå° –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {temp_min}¬∞C \nüå°–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {temp_max}¬∞C\n" \
                       f"üíß –û—Å–∞–¥–∫–∏ {precip}%"
            
            else:
                """
                –°–¶–ï–ù–ê–†–ò–ô: –ü–†–û–ì–ù–û–ó –ù–ê –ù–ï–°–ö–û–õ–¨–ö–û –î–ù–ï–ô
                –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–º –¥–Ω—è–º –∏ —Å–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                """
                result = f"üóì –ü—Ä–æ–≥–Ω–æ–∑ –¥–ª—è {city_name} –Ω–∞ {days} –¥–Ω–µ–π:\n\n"
                
                # –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –∫–∞–∂–¥–æ–º—É –¥–Ω—é –≤ –ø—Ä–æ–≥–Ω–æ–∑–µ
                for i in range(days):
                    # –î–∞–Ω–Ω—ã–µ –¥–ª—è i-–≥–æ –¥–Ω—è
                    day_max = forecast["daily"]["temperature_2m_max"][i]
                    day_min = forecast["daily"]["temperature_2m_min"][i]
                    precip = forecast["daily"]["precipitation_probability_max"][i]
                    
                    """
                    –í–´–ë–û–† –≠–ú–û–î–ó–ò –î–õ–Ø –ü–û–ì–û–î–´:
                    –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –æ—Å–∞–¥–∫–æ–≤
                    –ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –∏—Å–ø–æ–ª—å–∑—É—è weathercode –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
                    """
                    weather_emoji = "üåßÔ∏è" if precip > 60 else "üå¶Ô∏è" if precip > 30 else "‚òÄÔ∏è"
                    
                    # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–Ω–µ –≤ –æ–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    result += f"{weather_emoji} –î–µ–Ω—å {i+1}:\n" \
                             f"üå°–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:{day_min}¬∞C\n" \
                             f"üå°–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:{day_max}¬∞C,\n" \
                             f"üíß–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Å–∞–¥–∫–æ–≤: {precip}%\n\n"
                
                return result

    except Exception as e:
        """
        –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö:
        –õ–æ–≤–∏–º –ª—é–±—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è (—Å–µ—Ç—å, –ø–∞—Ä—Å–∏–Ω–≥ JSON, –∫–ª—é—á–∏ —Å–ª–æ–≤–∞—Ä—è –∏ —Ç.–¥.)
        """
        return f"–û—à–∏–±–∫–∞: {e}"